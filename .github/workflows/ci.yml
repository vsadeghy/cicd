name: build-and-lint
on:
    push:
        branches: [main, dev]
    pull_request:
        branches: [main, dev]

jobs:
    build-and-lint:
        runs-on: ubuntu-slim
        steps:
            - name: Checkout repo
              uses: actions/checkout@v6
            - name: install pnpm
              uses: pnpm/action-setup@v4
              with:
                  version: 10.16.1
            - name: setup node
              uses: actions/setup-node@v6
              with:
                  node-version: 25
                  cache: pnpm

            - name: install deps
              run: pnpm install --frozen-lockfile --ignore-scripts
            - name: lint
              run: pnpm lint
            - name: format
              run: pnpm format:check
            - name: types
              run: pnpm typecheck
            - name: test
              run: pnpm test
            - name: build
              run: docker build -t cicd .
